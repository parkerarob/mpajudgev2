<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MPA Judge</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="ios-app auth-locked">
    <header class="app-header">
      <div class="header-brand">
        <img src="/ncba-logo.png" alt="North Carolina Bandmasters Association logo" class="site-logo" />
        <div>
          <p class="eyebrow">North Carolina Bandmasters Association</p>
          <h1>Eastern District MPA</h1>
          <p class="lede">South Site - Ashley High School</p>
        </div>
      </div>
      <div class="auth-controls">
        <div class="note" id="authSuccess" hidden></div>
        <div class="row">
          <button type="button" id="signInBtn" class="btn--lg">Sign In / Create Account</button>
          <div id="headerAuthActions" class="auth-actions">
            <div class="auth-identity is-hidden" id="authIdentityBanner">
              <div class="auth-identity-name" id="authIdentityName">Signed in</div>
              <div class="auth-identity-email" id="authIdentityEmail"></div>
            </div>
            <div class="auth-action-row" id="headerAuthButtons">
              <button type="button" class="ghost" id="directorProfileToggleBtn">Update Profile</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="notice offline-banner is-hidden" id="offlineBanner" role="status" aria-live="polite">
        Offline: submissions are disabled until you reconnect.
      </div>
      <div class="notice notice--info" id="provisioningNotice" hidden role="status" aria-live="polite"></div>
      <nav class="tabs desktop-only" role="tablist" aria-label="Role views">
        <button class="tab" type="button" id="adminTab" role="tab" aria-controls="adminCard" data-tab="admin" aria-selected="false">
          Admin
        </button>
        <button class="tab" type="button" id="judgeOpenTab" role="tab" aria-controls="judgeOpenCard" data-tab="judge-open" aria-selected="false">
          Judge
        </button>
        <button class="tab" type="button" id="directorTab" role="tab" aria-controls="directorCard" data-tab="director" aria-selected="false">
          Director
        </button>
      </nav>
      <div class="hint" id="tabLockHint"></div>

      <section class="card" id="adminCard" role="tabpanel" aria-labelledby="adminTab">
        <div class="ios-nav mobile-only">
          <div class="ios-subtitle">Admin</div>
          <h2 class="ios-title">Home</h2>
          <div class="ios-subtitle">Manage event defaults, open packets, directories, and settings.</div>
        </div>
        <div class="tab-header desktop-only">
          <div>
            <h2>Admin Tools</h2>
            <div class="tab-subtitle">Manage event defaults, open packets, directories, and settings.</div>
          </div>
          <div class="tab-header-actions">
            <span class="badge" id="adminStatusBadge">No active event</span>
            <button type="button" class="ghost" id="adminProfileToggleBtn">Update Profile</button>
          </div>
        </div>
        <div class="ios-screen">
        <div class="stack">
          <div class="panel" id="adminEventsSection">
            <h3>Event Defaults</h3>
            <p class="hint">Create an event name and assign Stage 1/2/3/Sight judges. Open Judge still works without this.</p>
            <div class="stack">
              <div>
                <h4>Create Event</h4>
                <label>
                  Event Name
                  <input type="text" id="eventNameInput" placeholder="Eastern District MPA" />
                </label>
                <div class="row">
                  <button type="button" id="createEventBtn">Create Event</button>
                </div>
                <div class="note" id="activeEventDisplay">No active event.</div>
              </div>
              <div>
                <h4>Events</h4>
                <ul id="eventList" class="list"></ul>
              </div>
              <div>
                <h4>Judge Assignments</h4>
                <form id="assignmentsForm" class="stack">
                  <label>
                    Stage 1
                    <select id="stage1JudgeSelect"></select>
                  </label>
                  <label>
                    Stage 2
                    <select id="stage2JudgeSelect"></select>
                  </label>
                  <label>
                    Stage 3
                    <select id="stage3JudgeSelect"></select>
                  </label>
                  <label>
                    Sight Reading
                    <select id="sightJudgeSelect"></select>
                  </label>
                  <button type="submit">Save Assignments</button>
                </form>
                <div class="note" id="assignmentsError"></div>
              </div>
            </div>
          </div>

          <div class="panel" id="adminOpenPacketsSection">
            <h3>Open Packets</h3>
            <p class="hint">Manage open judge packets (no schedule required).</p>
            <div class="note" id="adminOpenPacketsHint"></div>
            <ul id="adminOpenPacketsList" class="list"></ul>
          </div>

          <div class="panel" id="adminLogisticsSection">
            <h3>Stage Setup Logistics</h3>
            <p class="hint">View seating chart and percussion needs from the Director entry for the active event.</p>
            <div class="stack">
              <div class="stack">
                <strong>Band On Stage</strong>
                <div class="row">
                  <label class="grow">
                    School
                    <select id="adminLogisticsCurrentSchoolSelect"></select>
                  </label>
                  <label class="grow">
                    Ensemble
                    <select id="adminLogisticsCurrentEnsembleSelect"></select>
                  </label>
                </div>
              </div>
              <div class="stack">
                <strong>Next Band</strong>
                <div class="row">
                  <label class="grow">
                    School
                    <select id="adminLogisticsNextSchoolSelect"></select>
                  </label>
                  <label class="grow">
                    Ensemble
                    <select id="adminLogisticsNextEnsembleSelect"></select>
                  </label>
                </div>
              </div>
              <div class="note" id="adminLogisticsStatus">Set an active event, then choose Band On Stage and Next Band.</div>
              <div class="stack" id="adminLogisticsContent"></div>
            </div>
          </div>

          <div class="panel" id="adminDutiesSection">
            <h3>Ensemble Admin Checkoffs</h3>
            <p class="hint">Track Signature Form and fee collection status for each ensemble in the active event.</p>
            <div class="stack">
              <div class="row">
                <label class="grow">
                  School
                  <select id="adminDutiesSchoolSelect"></select>
                </label>
                <label class="grow">
                  Search Ensemble
                  <input type="search" id="adminDutiesSearchInput" placeholder="Type ensemble name" />
                </label>
              </div>
              <div class="stack">
                <strong>All Schools Overview</strong>
                <div class="note" id="adminDutiesOverviewStatus">Set an active event to load the overview.</div>
                <div class="stack" id="adminDutiesOverviewList"></div>
              </div>
              <div class="note" id="adminDutiesSummary"></div>
              <div class="note" id="adminDutiesStatus">Set an active event, then choose a school.</div>
              <div class="stack" id="adminDutiesList"></div>
            </div>
          </div>

          <div class="panel" id="adminSchoolsSection">
            <h3>Directory</h3>
            <div class="stack">
              <div>
                <h4>Schools Directory</h4>
                <p class="hint">Seed schools for director selection.</p>
                <form id="schoolForm" class="stack">
                  <label>
                    School ID (slug)
                    <input type="text" id="schoolIdCreateInput" placeholder="school_001" required />
                  </label>
                  <label>
                    School Name
                    <input type="text" id="schoolNameCreateInput" required />
                  </label>
                  <div class="row">
                    <button type="submit" id="schoolSubmitBtn">Add School</button>
                    <button type="button" id="schoolEditCancelBtn" class="ghost is-hidden">
                      Cancel Edit
                    </button>
                  </div>
                </form>
                <label>
                  Bulk import (one per line: schoolId,School Name)
                  <textarea id="schoolBulkInput" rows="4"></textarea>
                </label>
                <button type="button" id="schoolBulkBtn" class="ghost">Import Bulk</button>
                <div class="note" id="schoolResult"></div>
                <div class="stack">
                  <h4>Manage Existing School</h4>
                  <label>
                    Select School
                    <select id="adminSchoolManageSelect"></select>
                  </label>
                  <div class="row">
                    <button type="button" id="adminSchoolManageEditBtn" class="ghost">Edit</button>
                    <button type="button" id="adminSchoolManageDeleteBtn" class="ghost">Delete</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="panel" id="adminSettingsSection">
            <h3>Users</h3>
            <div class="stack">
              <div>
                <h4>Provision User</h4>
                <p class="hint">
                  Admin-only. Creates an Auth user (email/password) and writes
                  a user profile document. Share the temporary password securely.
                </p>
                <form id="provisionForm" class="stack">
                  <label>
                    Email
                    <input type="email" id="provisionEmailInput" required />
                  </label>
                  <label>
                    Name
                    <input type="text" id="provisionNameInput" placeholder="Optional for directors" />
                  </label>
                  <label>
                    Role
                    <select id="provisionRoleSelect" required>
                      <option value="judge">judge</option>
                      <option value="director">director</option>
                    </select>
                  </label>
                  <label>
                    School (optional, director only)
                    <select id="provisionSchoolSelect"></select>
                  </label>
                  <label>
                    Temporary Password (optional)
                    <input type="text" id="provisionTempPasswordInput" placeholder="Leave blank to auto-generate" />
                  </label>
                  <button type="submit">Provision User</button>
                </form>
                <div class="note" id="provisionResult"></div>
              </div>
            </div>
          </div>
        </div>
        </div>
      </section>

      <section class="card judge-open-card" id="judgeOpenCard" role="tabpanel" aria-labelledby="judgeOpenTab">
        <div class="ios-nav mobile-only">
          <div class="ios-subtitle">Judge</div>
          <h2 class="ios-title">Judging</h2>
          <div class="ios-subtitle">Record, transcribe, and submit without a schedule.</div>
        </div>
        <div class="tab-header desktop-only">
          <div>
            <h2>Judge Sheet</h2>
            <div class="tab-subtitle">Record, transcribe, and submit without a schedule.</div>
          </div>
          <div class="tab-header-actions">
            <span class="badge" id="judgeOpenStatusBadge">Draft</span>
            <button type="button" class="ghost" id="judgeOpenProfileToggleBtn">Update Profile</button>
          </div>
        </div>
        <div class="ios-screen">
          <div class="judge-open-layout">
            <div class="judge-open-list" id="judgeOpenListView">
              <div class="panel stack judge-open-list-panel">
                <div class="row judge-open-list-toolbar">
                  <strong>My Packets</strong>
                  <div class="row">
                    <button type="button" id="judgeOpenNewPacketBtn" class="btn--secondary">Start New Tape</button>
                    <button type="button" id="judgeOpenClearRecentBtn" class="ghost">Clear Recent</button>
                  </div>
                </div>
                <div class="note" id="judgeOpenPacketHint"></div>
                <select id="judgeOpenPacketSelect" class="is-hidden"></select>
                <div class="packet-card-list" id="judgeOpenPacketList"></div>
              </div>
              <div class="empty" id="judgeOpenEmpty">Create or select a packet to begin.</div>
            </div>

            <div class="judge-open-detail" id="judgeOpenDetailView">
              <div class="detail-header">
                <button type="button" class="ghost" id="judgeOpenBackBtn">Back</button>
                <div class="detail-title">
                  <div class="detail-title-main" id="judgeOpenHeaderTitle">School - Ensemble</div>
                  <div class="detail-title-sub" id="judgeOpenHeaderSub">Draft</div>
                </div>
              </div>

              <div class="panel stack judge-open-summary-panel" id="judgeOpenSummaryPanel">
                <div class="row">
                  <div class="event-meta">
                    <div class="event-meta-name" id="judgeOpenSummaryTitle">School - Ensemble</div>
                    <div class="event-meta-detail" id="judgeOpenSummaryMeta">Draft packet</div>
                  </div>
                  <span class="badge" id="judgeOpenSummaryStatus">Draft</span>
                </div>
                <div class="note" id="judgeOpenSummaryHint">Record, transcribe, and submit without a schedule.</div>
              </div>

              <div class="panel stack judge-open-step-card">
                <div class="step-heading">
                  <span class="badge">Step 1</span>
                  <strong>Identify Ensemble</strong>
                </div>
                <label class="row" style="align-items:center;">
                  <input type="checkbox" id="judgeOpenUseEventDefaultsToggle" />
                  <span>Use active event defaults when available</span>
                </label>
                <div class="note" id="judgeOpenEventDefaultsStatus">
                  Open mode: no active event assignment.
                </div>
                <div class="row">
                  <button type="button" id="judgeOpenSaveEventDefaultsBtn" class="ghost">
                    Save Mode Default
                  </button>
                </div>
                <label>
                  Select existing ensemble (prefills School/Ensemble)
                  <select id="judgeOpenExistingSelect"></select>
                </label>
                <div class="hint">
                  Optional: choosing an existing ensemble links this packet and pre-fills fields. Manual entry is allowed.
                </div>
                <div class="row">
                  <label class="grow">
                    School
                    <input type="text" id="judgeOpenSchoolNameInput" placeholder="School name" />
                  </label>
                  <label class="grow">
                    Ensemble
                    <input type="text" id="judgeOpenEnsembleNameInput" placeholder="Ensemble name" />
                  </label>
                </div>
                <select id="judgeOpenFormTypeSelect" class="is-hidden">
                  <option value="stage">Stage</option>
                  <option value="sight">Sight Reading</option>
                </select>
                <div class="segmented-control" id="judgeOpenFormTypeSegmented">
                  <button type="button" class="segment btn--secondary" data-form="stage">Stage</button>
                  <button type="button" class="segment btn--secondary" data-form="sight">Sight Reading</button>
                  <button type="button" id="judgeOpenDefaultFormBtn" class="ghost">Set as default</button>
                </div>
              </div>

              <div class="panel stack judge-open-step-card" id="judgeOpenDirectorRefPanel">
                <div class="step-heading">
                  <span class="badge">Reference</span>
                  <strong>Director Entry</strong>
                </div>
                <div class="note" id="judgeOpenDirectorRefStatus">
                  Link an existing ensemble to load Director repertoire/instrumentation.
                </div>
                <div class="stack" id="judgeOpenDirectorRefContent"></div>
              </div>

              <div class="panel stack judge-open-step-card">
                <div class="step-heading">
                  <span class="badge">Step 2</span>
                  <strong>Record Tape</strong>
                </div>
                <div class="recording-control">
                  <button type="button" id="judgeOpenRecordBtn" class="btn--secondary record-btn">
                    <span class="record-dot" id="judgeOpenRecordDot" aria-hidden="true"></span>
                    <span data-button-label id="judgeOpenRecordLabel">Start Recording</span>
                  </button>
                  <button type="button" id="judgeOpenStopBtn" class="btn--secondary" disabled>Stop</button>
                  <div class="recording-meta">
                    <span id="judgeOpenRecordingStatus" class="hint"></span>
                    <div class="hint" id="judgeOpenMicSettingsDebug"></div>
                    <div class="level-meter" id="judgeOpenLevelMeter" aria-hidden="true">
                      <div class="level-meter-fill" id="judgeOpenLevelMeterFill"></div>
                    </div>
                    <div class="note" id="judgeOpenTapeDurationRow">
                      Tape Duration: <span id="judgeOpenTapeDuration">0:00</span>
                    </div>
                  </div>
                </div>
                <div class="empty" id="judgeOpenTapeEmpty">No audio yet.</div>
                <audio id="judgeOpenTapePlayback" controls class="audio"></audio>
                <details class="accordion-card readiness-details" id="judgeOpenSegmentsDetails">
                  <summary>
                    <span id="judgeOpenSegmentsSummary">Segments (0)</span>
                    <span class="muted readiness-hint"></span>
                  </summary>
                  <ul id="judgeOpenSegmentsList" class="list list--compact"></ul>
                </details>
              </div>

              <details class="panel transcript-panel judge-open-step-card" id="judgeOpenTranscriptPanel" open>
                <summary class="step-heading">
                  <span class="badge">Step 3</span>
                  <strong>Transcript</strong>
                </summary>
                <textarea id="judgeOpenTranscriptInput" rows="6" aria-label="Transcript"></textarea>
                <div class="row">
                  <button type="button" id="judgeOpenTranscribeBtn" class="ghost btn--secondary">
                    Transcribe Tape
                  </button>
                </div>
              </details>

              <div class="panel stack judge-open-step-card">
                <div class="step-heading">
                  <span class="badge">Step 4</span>
                  <strong>Captions</strong>
                </div>
                <div class="stack">
                  <div class="row">
                    <button type="button" id="judgeOpenDraftBtn" class="btn--secondary">
                      Draft Captions from Transcript
                    </button>
                    <label class="row">
                      <input type="checkbox" id="judgeOpenOverwriteCaptionsToggle" />
                      Overwrite existing captions
                    </label>
                  </div>
                  <div class="hint" id="judgeOpenDraftStatus"></div>
                </div>
                <div id="judgeOpenCaptionForm" class="stack"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="sticky-bottom" id="judgeOpenStickyBar">
          <div class="sticky-meta">
            <div>Total: <span id="judgeOpenCaptionTotal">0</span></div>
            <div>Rating: <span id="judgeOpenFinalRating">N/A</span></div>
          </div>
          <button type="button" id="judgeOpenSubmitBtn" class="btn--lg btn-primary">Submit</button>
        </div>
      </section>

      <section class="card" id="directorCard" role="tabpanel" aria-labelledby="directorTab">
        <div class="ios-nav mobile-only">
          <div class="ios-subtitle">Director</div>
          <h2 class="ios-title">Registrations</h2>
          <div class="ios-subtitle">Complete Day of Forms and review released results packets.</div>
        </div>
        <div class="tab-header desktop-only">
          <div>
            <h2>Ensemble Registrations</h2>
            <div class="tab-subtitle">Complete Day of Forms and review released results packets.</div>
          </div>
          <div class="tab-header-actions">
            <span class="badge" id="directorEntryStatusBadge">Incomplete</span>
          </div>
        </div>
        <div class="ios-screen">
          <div class="panel director-summary" id="directorSummary">
            <div class="director-summary-school">
              <div class="director-summary-school-row">
                <div class="director-summary-school-name" id="directorSummarySchool">No school attached</div>
                <div class="row" id="directorDetachControls">
                  <button type="button" id="directorDetachBtn" class="ghost">
                    Change School
                  </button>
                </div>
              </div>
              <div class="director-summary-attached" id="directorSummaryAttachedContent">
                <ul id="directorEnsembleList" class="list ensembles-list"></ul>
                <button type="button" id="directorShowEnsembleFormBtn" class="btn--secondary">
                  Create New Ensemble
                </button>
                <div class="director-summary-directors" id="directorSchoolDirectors"></div>
              </div>
              <div class="row" id="directorAttachControls">
                <select id="directorAttachSelect"></select>
                <button type="button" id="directorAttachBtn">Confirm School</button>
              </div>
            </div>
        </div>
        <div class="stack" id="directorMainStack">
          <div class="stack" id="directorEnsemblesSection">
            <form id="directorEnsembleForm" class="stack is-hidden">
              <label>
                Ensemble Name
                <input type="text" id="directorEnsembleNameInput" />
              </label>
              <div class="error" id="directorEnsembleError"></div>
              <div class="actions">
                <button type="submit" id="directorEnsembleSubmitBtn">Create Ensemble</button>
                <button type="button" class="ghost" id="directorEnsembleCancelBtn">
                  Cancel
                </button>
              </div>
            </form>
          </div>

            <div class="panel group" id="directorEntryPanel">
            <h3>Event Entry</h3>
            <div class="row">
              <div class="note">Status: <span id="directorEntryStatus">Incomplete</span></div>
              <div class="note" id="directorAdminDutiesStatus">Admin Checkoffs: Not recorded yet</div>
              <div class="note" id="directorSchoolLunchTotal"></div>
              <div class="note" id="directorSaveStatus"></div>
              <span class="autosave-indicator" id="directorAutosaveIndicator">Autosaved</span>
            </div>
            <div class="note" id="directorEntryHint">
              Select an ensemble and event to begin.
            </div>
            <div class="row">
              <div class="active-ensemble-text is-hidden" id="directorActiveEnsemblePill">None selected</div>
              <button type="button" class="ghost is-hidden" id="directorEditActiveEnsembleBtn">
                Edit Active
              </button>
            </div>
            <form id="directorEntryForm" class="stack">
              <label>
                Performance Grade (auto-derived from repertoire grades)
                <input type="text" id="directorPerformanceGradeInput" placeholder="Auto-derived" readonly />
              </label>
              <input type="checkbox" id="directorPerformanceGradeFlex" hidden />
              <div class="error" id="performanceGradeError"></div>
              <details class="panel accordion-card" open>
                <summary>
                  <div>
                    <strong>Repertoire</strong>
                  </div>
                </summary>
                <div class="form-section">
                  <div id="repertoireFields" class="stack"></div>
                <div class="actions">
                  <button type="button" id="saveRepertoireBtn">Save Repertoire</button>
                  <div class="hint" id="saveRepertoireStatus"></div>
                </div>
                </div>
              </details>

              <details class="panel accordion-card">
                <summary>
                  <div>
                    <strong>Instrument Counts</strong>
                  </div>
                </summary>
                <div class="form-section">
                  <div id="instrumentationStandard" class="grid-inputs"></div>
                  <label>
                    Total Percussion
                    <input type="number" id="instrumentationTotalPercussion" min="0" value="0" />
                  </label>
                <div class="actions">
                  <button type="button" id="saveInstrumentationBtn">Save Instrument Counts</button>
                  <div class="hint" id="saveInstrumentationStatus"></div>
                </div>
                </div>
              </details>

              <details class="panel accordion-card">
                <summary>
                  <div>
                    <strong>Non-Standard Instrumentation / Notes</strong>
                  </div>
                </summary>
                <div class="form-section">
                  <div class="stack">
                    <div class="row">
                      <strong>Non-standard instrumentation</strong>
                      <button type="button" class="ghost" id="instrumentationNonStandardAddBtn">
                        Add Instrument
                      </button>
                    </div>
                    <div id="instrumentationNonStandard" class="stack"></div>
                  </div>
                  <label>
                    Notes
                    <textarea id="otherInstrumentationNotesInput" rows="3"></textarea>
                  </label>
                <div class="actions">
                  <button type="button" id="saveNonStandardBtn">Save Instrument Notes</button>
                  <div class="hint" id="saveNonStandardStatus"></div>
                </div>
                </div>
              </details>

              <details class="panel accordion-card">
                <summary>
                  <div>
                    <strong>Rule 3C Doubling</strong>
                  </div>
                </summary>
                <div class="form-section">
                  <div id="rule3cRows" class="stack"></div>
                  <label>
                    Rule 3C notes
                    <textarea id="rule3cNotesInput" rows="3"></textarea>
                  </label>
                <div class="actions">
                  <button type="button" id="saveRule3cBtn">Save Rule 3C</button>
                  <div class="hint" id="saveRule3cStatus"></div>
                </div>
                </div>
              </details>

              <details class="panel accordion-card">
                <summary>
                  <div>
                    <strong>Seating Chart</strong>
                  </div>
                </summary>
                <div class="form-section">
                  <div id="seatingRows" class="stack"></div>
                  <label>
                    Seating / setup notes
                    <textarea id="seatingNotesInput" rows="3"></textarea>
                  </label>
                <div class="actions">
                  <button type="button" id="saveSeatingBtn">Save Seating</button>
                  <div class="hint" id="saveSeatingStatus"></div>
                </div>
                </div>
              </details>

              <details class="panel accordion-card">
                <summary>
                  <div>
                    <strong>Percussion</strong>
                  </div>
                </summary>
                <div class="form-section">
                  <div id="percussionOptions" class="grid-options"></div>
                  <label>
                    Other percussion requests
                    <textarea id="percussionNotesInput" rows="3"></textarea>
                  </label>
                <div class="actions">
                  <button type="button" id="savePercussionBtn">Save Percussion</button>
                  <div class="hint" id="savePercussionStatus"></div>
                </div>
                </div>
              </details>

              <details class="panel accordion-card">
                <summary>
                  <div>
                    <strong>Lunch Buy-In</strong>
                  </div>
                </summary>
                  <div class="form-section">
                    <div class="hint">
                      Each lunch includes two slices of pizza, chips/snack, and soda or bottled water.
                      Cost per meal is $8.00.
                    </div>
                  <label>
                    Pepperoni pizza lunch quantity
                    <input type="number" id="lunchPepperoniInput" min="0" value="0" />
                  </label>
                  <label>
                    Cheese pizza lunch quantity
                    <input type="number" id="lunchCheeseInput" min="0" value="0" />
                  </label>
                <div class="actions">
                  <button type="button" id="saveLunchBtn">Save Lunch</button>
                  <div class="hint" id="lunchTotalCost">$0.00</div>
                  <div class="hint">Make checks payable to Ashley High School Band Boosters.</div>
                  <div class="hint">Payment accepted by check or cash (one lump-sum payment for total meals).</div>
                  <div class="hint" id="saveLunchStatus"></div>
                </div>
                </div>
                </details>

                <div class="actions entry-ready-actions">
                  <button type="button" id="directorEntryReadyBtn" class="full-width-cta">
                    Mark as Ready
                  </button>
                </div>

                </form>
              </div>

              <details class="panel accordion-card group">
            <summary>
              <div>
                <strong>Results Packet</strong>
              </div>
            </summary>
            <div class="form-section">
              <div class="empty" id="directorEmpty">No results released yet.</div>
              <div id="directorPackets" class="stack"></div>
              </div>
              </details>
          </div>
        </div>
      </section>

      <section class="card is-hidden" id="eventDetailPage">
        <div class="row">
          <h2 id="eventDetailTitle">Event Details</h2>
          <button type="button" class="ghost" id="eventDetailBackBtn">Back to Dashboard</button>
        </div>
        <div class="note" id="eventDetailMeta"></div>
        <div class="panel">
          <h3>Event Schedule</h3>
          <div class="stack">
            <div class="panel" id="eventScheduleBuilderPanel">
              <div class="row">
                <strong>Schedule Builder (Optional)</strong>
                <div class="note" id="eventSchedulePublishedMeta"></div>
              </div>
              <div class="row">
                <button type="button" class="ghost" id="eventSchedulePublishBtn">Publish Schedule</button>
                <button type="button" class="ghost" id="eventScheduleUnpublishBtn">Unpublish</button>
                <div class="note" id="eventScheduleDraftStatus"></div>
              </div>
              <div class="stack">
                <strong>Add Schedule Row</strong>
                <div class="row">
                  <label class="grow">
                    School
                    <select id="eventScheduleAddSchoolSelect"></select>
                  </label>
                  <label class="grow">
                    Ensemble
                    <select id="eventScheduleAddEnsembleSelect"></select>
                  </label>
                  <label>
                    Order
                    <input type="number" id="eventScheduleAddOrderInput" min="1" step="1" placeholder="1" />
                  </label>
                </div>
                <div class="row">
                  <label class="grow">
                    Holding
                    <input type="datetime-local" id="eventScheduleAddHoldingInput" />
                  </label>
                  <label class="grow">
                    Warm-up
                    <input type="datetime-local" id="eventScheduleAddWarmupInput" />
                  </label>
                  <label class="grow">
                    Performance
                    <input type="datetime-local" id="eventScheduleAddPerformanceInput" />
                  </label>
                  <label class="grow">
                    Sight-reading (optional)
                    <input type="datetime-local" id="eventScheduleAddSightInput" />
                  </label>
                  <label>
                    &nbsp;
                    <button type="button" id="eventScheduleAddRowBtn">Add Row</button>
                  </label>
                </div>
              </div>
              <div class="empty" id="eventScheduleDraftEmpty">No schedule rows yet. Add rows to build a schedule.</div>
              <div id="eventScheduleDraftTableWrap" style="display:none; overflow:auto;">
                <table style="width:100%; border-collapse:collapse;">
                  <thead>
                    <tr>
                      <th style="text-align:left;">Order</th>
                      <th style="text-align:left;">School</th>
                      <th style="text-align:left;">Ensemble</th>
                      <th style="text-align:left;">Holding</th>
                      <th style="text-align:left;">Warm-up</th>
                      <th style="text-align:left;">Performance</th>
                      <th style="text-align:left;">Sight</th>
                      <th style="text-align:left;">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="eventScheduleDraftBody"></tbody>
                </table>
              </div>
            </div>

            <div class="panel" id="eventSchedulePublishedSection">
              <div class="row">
                <strong>Published Schedule (Director View)</strong>
                <div class="note" id="eventSchedulePublishedStatus"></div>
              </div>
              <div class="empty" id="eventSchedulePublishedEmpty">Schedule not published yet.</div>
              <div id="eventSchedulePublishedTableWrap" style="display:none; overflow:auto;">
                <table style="width:100%; border-collapse:collapse;">
                  <thead>
                    <tr>
                      <th style="text-align:left;">Order</th>
                      <th style="text-align:left;">School</th>
                      <th style="text-align:left;">Ensemble</th>
                      <th style="text-align:left;">Holding</th>
                      <th style="text-align:left;">Warm-up</th>
                      <th style="text-align:left;">Performance</th>
                      <th style="text-align:left;">Sight</th>
                    </tr>
                  </thead>
                  <tbody id="eventSchedulePublishedBody"></tbody>
                </table>
              </div>
            </div>

            <details class="panel">
              <summary>
                <strong>Legacy PDF Schedule (Optional)</strong>
              </summary>
              <div class="stack" style="margin-top:8px;">
                <div class="row" id="eventScheduleAdminControls">
                  <input type="file" id="eventScheduleFileInput" accept="application/pdf" />
                  <button type="button" class="ghost" id="eventScheduleUploadBtn">Upload PDF</button>
                </div>
                <div class="note" id="eventScheduleStatus"></div>
                <div class="row" id="eventScheduleLinkRow">
                  <a id="eventScheduleLink" href="#" target="_blank" rel="noopener">Open Schedule PDF</a>
                </div>
                <iframe
                  id="eventScheduleFrame"
                  title="Event Schedule PDF"
                  style="width:100%; min-height:70vh; border:1px solid var(--border); border-radius:8px; display:none;"
                ></iframe>
                <div class="empty" id="eventScheduleEmpty">No schedule PDF uploaded yet.</div>
              </div>
            </details>
          </div>
        </div>
      </section>
    </main>

      <div class="modal" id="authModal" aria-hidden="true">
        <div class="modal-backdrop" id="authModalBackdrop"></div>
        <div class="modal-panel" role="dialog" aria-modal="true" aria-label="Sign in">
          <div class="modal-header">
            <h2>Sign In</h2>
            <button type="button" class="ghost" id="authModalClose">Close</button>
          </div>
          <div id="authSignInView" class="stack">
            <form id="emailForm" class="stack">
              <label>
                Email
                <input type="email" id="emailInput" required />
              </label>
              <label>
                Password
                <input type="password" id="passwordInput" required />
              </label>
              <div class="row">
                <button type="submit" id="emailSignInBtn">Sign In</button>
                <button type="button" id="anonymousBtn" class="ghost">
                  Anonymous Sign In
                </button>
              </div>
              <button type="button" id="forgotPasswordBtn" class="ghost">
                Forgot password
              </button>
            </form>
            <button type="button" id="showDirectorSignupBtn" class="ghost">
              Create Director Account
            </button>
          </div>

          <div id="authDirectorView" class="stack is-hidden">
            <h3>Create Director Account</h3>
            <label>
              Email
              <input type="email" id="directorEmailInput" />
            </label>
            <label>
              Password
              <input type="password" id="directorPasswordInput" />
            </label>
            <label>
              School (required)
              <select id="directorSchoolSelect"></select>
            </label>
            <button type="button" id="directorSignupBtn">Create Director Account</button>
            <button type="button" id="backToSignInBtn" class="ghost">
              Back to Sign In
            </button>
            <div class="hint">
              Directors only. Judges are provisioned by admin. Directors can switch schools later.
            </div>
          </div>

          <div id="authAccountView" class="stack is-hidden">
            <div class="note" id="accountSummary"></div>
            <div class="row" id="modalAuthActions">
              <button type="button" id="signOutBtn" class="ghost" disabled>
                Sign Out
              </button>
            </div>
          </div>
          <div class="note" id="roleHint"></div>
        </div>
      </div>

      <div class="modal" id="sessionExpiredModal" aria-hidden="true">
        <div class="modal-backdrop" id="sessionExpiredBackdrop"></div>
        <div class="modal-panel" role="dialog" aria-modal="true" aria-label="Session expired">
          <div class="modal-header">
            <h2>Session Expired</h2>
          </div>
          <div class="stack">
            <div class="note">Session expired. Please sign in again.</div>
            <button type="button" id="sessionExpiredSignInBtn">Sign In</button>
          </div>
        </div>
      </div>

      <div class="modal" id="directorProfileModal" aria-hidden="true">
        <div class="modal-backdrop" id="directorProfileBackdrop"></div>
        <div class="modal-panel" role="dialog" aria-modal="true" aria-label="Director Profile">
          <div class="modal-header">
            <h2>Director Profile</h2>
            <button type="button" class="ghost" id="directorProfileClose">Close</button>
          </div>
          <form id="directorProfileForm" class="stack">
            <label>
              Name
              <input type="text" id="directorProfileNameInput" />
            </label>
            <label>
              NAfME Membership Number
              <input type="text" id="directorProfileNafmeNumberInput" />
            </label>
            <label>
              NAfME Membership Expiration Date
              <input type="date" id="directorProfileNafmeExpInput" />
            </label>
            <label>
              Membership Card Image
              <input type="file" id="directorProfileCardInput" accept="image/*" />
            </label>
            <div class="note" id="directorProfileCardStatus"></div>
            <img id="directorProfileCardPreview" class="profile-preview is-hidden" alt="Membership card preview" />
            <div class="row">
              <button type="submit" id="directorProfileSaveBtn">Save Profile</button>
              <button type="button" class="ghost" id="directorProfileCancelBtn">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <div class="modal" id="userProfileModal" aria-hidden="true">
        <div class="modal-backdrop" id="userProfileBackdrop"></div>
        <div class="modal-panel" role="dialog" aria-modal="true" aria-label="Profile">
          <div class="modal-header">
            <h2>Profile</h2>
            <button type="button" class="ghost" id="userProfileClose">Close</button>
          </div>
          <form id="userProfileForm" class="stack">
            <label>
              Display Name
              <input type="text" id="userProfileNameInput" />
            </label>
            <div class="note" id="userProfileStatus"></div>
            <div class="row">
              <button type="submit" id="userProfileSaveBtn">Save</button>
              <button type="button" class="ghost" id="userProfileCancelBtn">Cancel</button>
            </div>
          </form>
        </div>
      </div>

    <script src="/shared/grade1-lookup.js"></script>
    <script type="module" src="/app.js"></script>
  </body>
</html>
      
